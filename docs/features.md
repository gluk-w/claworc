# Features

## Instance Management

### Create Instance
- User provides a display name (e.g., "Bot Alpha") which is converted to a K8s-safe name (e.g., "bot-alpha")
- System automatically allocates the next available NodePort pair from range 30100-30199 (consecutive even/odd pair)
- Creates all required Kubernetes resources: PVCs, Secret, ConfigMap, Deployment, Service
- Optional: override global API keys with instance-specific keys
- Optional: customize resource limits (CPU, memory, storage sizes)
- Instance starts automatically after creation

### Start / Stop Instance
- **Stop**: Scales the Deployment to 0 replicas. All PVCs are preserved so data persists (Chrome profile, clawdbot data, homebrew packages, clawd folder)
- **Start**: Scales the Deployment back to 1 replica. Pod resumes with all persistent data intact
- Status transitions: `running` <-> `stopped`

### Restart Instance
- Performs a rolling restart of the Deployment (equivalent to `kubectl rollout restart`)
- Used after configuration changes or to recover from issues

### Delete Instance
- Requires user confirmation
- Deletes all Kubernetes resources: Deployment, Service, PVCs, Secret, ConfigMap
- Releases the NodePort pair back to the pool
- Removes instance record from the database

### Instance Status
- Real-time status from Kubernetes pod state
- States: `creating`, `running`, `stopped`, `error`
- Dashboard shows status badges with visual indicators

## VNC Access (Dual Sessions)

Each instance exposes **two separate VNC sessions** via consecutive NodePort pairs:

- **Chrome VNC** (even port): Google Chrome running in kiosk mode (fullscreen, no window decorations)
- **Terminal VNC** (odd port): xterm running fullscreen for command-line access

| Session | Display | VNC Port | noVNC Port | NodePort | URL |
|---------|---------|----------|------------|----------|-----|
| Chrome  | `:1`    | 5901     | 6081       | Even (e.g., 30100) | `http://192.168.1.104:30100/vnc.html?autoconnect=true` |
| Terminal| `:2`    | 5902     | 6082       | Odd (e.g., 30101)  | `http://192.168.1.104:30101/vnc.html?autoconnect=true` |

- NodePort pairs are allocated consecutively: Instance 1 gets 30100/30101, Instance 2 gets 30102/30103, etc.
- Maximum 50 instances (ports 30100-30199)
- Displays are fully isolated — no window switching (no Alt+Tab) between Chrome and Terminal
- No desktop environment or window manager — each display runs a single maximized application
- VNC has no password (SecurityTypes None) — internal network only
- Resolution: 1920x1080, 24-bit color depth

### Chrome Profile Persistence
- Chrome user profile is persisted across pod restarts using a dedicated `chrome-data` PVC
- The `chrome-data` PVC is mounted at `/root/.config/google-chrome`
- Users can sign into Chrome, install extensions, and save bookmarks -- all persists

## Configuration Editing

### Clawdbot JSON Config
- Each instance has a `clawdbot.json` configuration file
- Editable via a Monaco (VS Code) editor in the browser
- Initial config is generated by running `openclaw onboard`

### Config Update Flow
1. User edits JSON in the Monaco editor
2. Frontend validates JSON syntax before submission
3. Backend validates the JSON structure
4. Backend updates the file on the PVC

### API Key Substitution
- API keys are injected as environment variables from a Kubernetes Secret
- Config file can reference them using `${ANTHROPIC_API_KEY}`, `${OPENAI_API_KEY}`, `${BRAVE_API_KEY}` syntax
- Clawdbot natively supports environment variable substitution in its config

## API Key Management

### Global Settings
- Global API keys for: Anthropic, OpenAI, Brave Search
- Stored encrypted (Fernet) in SQLite settings table
- Applied to all instances that don't have instance-specific overrides
- Keys are masked in the UI (showing only last 4 characters)

### Per-Instance Overrides
- Any instance can override one or more global API keys
- Override keys are stored encrypted in the instance record
- NULL value means "use global key"
- Kubernetes Secret for each instance is populated with the effective key (override or global fallback)

## Log Viewing

- Real-time pod logs streamed via Server-Sent Events (SSE)
- Accessible from the instance detail page under a "Logs" tab
- Reads from the Kubernetes pod log API

## Persistent Storage

Each instance gets four PVCs:

| PVC             | Default Size                       | Mount Path                    | Purpose |
|-----------------|------------------------------------|-------------------------------|---------|
| `clawdbot-data` | 5Gi                                | `/root/.clawdbot`             | Clawdbot data |
| `homebrew-data` | 10Gi                               | `/home/linuxbrew/.linuxbrew`  | Homebrew packages and formulas |
| `clawd-data`    | 5Gi                                | `/root/clawd`                 | Clawd working directory |
| `chrome-data`   | 5Gi | `/root/.config/google-chrome` | Google Chrome's profile |

Storage sizes are configurable per instance at creation time.

## Resource Limits

Default resource allocation per instance (configurable):

| Resource | Request | Limit |
|----------|---------|-------|
| CPU | 500m | 2000m |
| Memory | 1Gi | 4Gi |

With 5-20 concurrent instances, total cluster resource requirements range from 2.5-10 CPU cores and 5-80 GB memory.
